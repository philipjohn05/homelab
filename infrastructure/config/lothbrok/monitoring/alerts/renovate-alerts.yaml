apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: renovate-alerts
  namespace: monitoring
  labels:
    prometheus: kube-prometheus-stack-prometheus
    role: alert-rules
    release: kube-prometheus-stack
    app: renovate
spec:
  groups:
    - name: applications.renovate
      interval: 30s
      rules:
        - alert: RenovateJobFailed
          expr: kube_job_status_failed{namespace="renovate",job_name=~"renovate.*"} > 0
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "Renovate job {{ $labels.job_name }} failed"
            description: "Renovate job {{ $labels.job_name }} in namespace {{ $labels.namespace }} has failed. Check logs for dependency update issues."

        - alert: RenovateJobTakingTooLong
          expr: time() - kube_job_status_start_time{namespace="renovate",job_name=~"renovate.*"} > 1800
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "Renovate job {{ $labels.job_name }} running too long"
            description: "Renovate job {{ $labels.job_name }} has been running for more than 30 minutes. May be stuck or experiencing network issues."

        - alert: RenovateCronJobSuspended
          expr: kube_cronjob_spec_suspend{namespace="renovate",cronjob="renovate"} > 0
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: "Renovate CronJob is suspended"
            description: "Renovate CronJob is suspended. Dependency updates are not running."

        - alert: RenovatePodCrashLooping
          expr: rate(kube_pod_container_status_restarts_total{namespace="renovate"}[15m]) > 0
          for: 5m
          labels:
            severity: warning
          annotations:
            summary: "Renovate pod {{ $labels.pod }} is crash looping"
            description: 'Renovate pod {{ $labels.pod }} has restarted {{ printf "%.2f" $value }} times in the last 15 minutes'

        - alert: RenovateJobNotRunRecently
          expr: (time() - kube_cronjob_status_last_schedule_time{namespace="renovate",cronjob="renovate"}) > 86400
          for: 1h
          labels:
            severity: warning
          annotations:
            summary: "Renovate hasn't run in 24 hours"
            description: "Renovate CronJob hasn't run successfully in over 24 hours. Dependency updates may be stalled."

        - alert: RenovateJobStuckInPending
          expr: kube_pod_status_phase{namespace="renovate",phase="Pending"} == 1
          for: 10m
          labels:
            severity: warning
          annotations:
            summary: "Renovate pod {{ $labels.pod }} stuck in Pending"
            description: "Renovate pod {{ $labels.pod }} has been in Pending state for more than 10 minutes. May be resource or scheduling issues."
